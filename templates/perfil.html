<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perfil do Usuário</title>

    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@2.4.1/dist/flowbite.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles/global.css') }}"
    />

    <!-- CSS Específico da Página de Perfil -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='../styles/perfil.css') }}"
    />

    <style>
      .error-message {
        color: red;
        text-align: center;
        margin: 10px 0;
      }
      .success-message {
        color: green;
        text-align: center;
        margin: 10px 0;
      }
    </style>
</head>
<body>
    <!-- Header include -->
    {% include 'components/header.html' %}

    <main class="main-content">
      <section class="perfil-container max-w-screen-xl mx-auto p-4">
        <h1 class="form-title">Meu Perfil</h1>

        {% if error %}
          <p class="error-message">{{ error }}</p>
        {% endif %}

        {% if success %}
          <p class="success-message">{{ success }}</p>
        {% endif %}

        {% if usuario %}
          <div class="perfil-info bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Informações Pessoais</h2>
            <p><strong>Nome Completo:</strong> {{ usuario.nome }}</p>
            <p><strong>Email:</strong> {{ usuario.email }}</p>
            <p><strong>Telefone:</strong> {{ usuario.telefone }}</p>
            <p><strong>Data de Nascimento:</strong> {{ usuario.data_nascimento }}</p>
            <p><strong>Gênero:</strong> {{ usuario.genero }}</p>
            <p><strong>CEP:</strong> {{ usuario.cep }}</p>
            <p><strong>Endereço:</strong> {{ usuario.endereco }}</p>
            <p><strong>Tipo Sanguíneo:</strong> {{ usuario.tipo_sanguineo }}</p>
            <p><strong>Já doou sangue?:</strong> {{ usuario.ja_doou }}</p>
            <p><strong>Primeira vez:</strong> {{ usuario.primeira_vez or 'N/A' }}</p>
            <p><strong>Interesse em doar:</strong> {{ usuario.interesse }}</p>
            <p><strong>Autoriza mensagens?:</strong> {{ 'Sim' if usuario.autoriza_msg else 'Não' }}</p>
            <p><strong>Autoriza uso de dados?:</strong> {{ 'Sim' if usuario.autoriza_dados else 'Não' }}</p>
            <p><strong>Pontos:</strong> {{ usuario.pontos }}</p>
            <p><strong>Nível:</strong> {{ usuario.nivel }}</p>
            <p><strong>Progresso:</strong> {{ usuario.progressoPercentual }}%</p>
            {% if usuario.selos %}
              <h3 class="text-lg font-semibold mt-4">Selos</h3>
              <ul>
                {% for selo in usuario.selos %}
                  <li class="flex items-center">
                    <img
                      src="{{ url_for('static', filename=selo.caminhoImagem) }}"
                      alt="{{ selo.nome }}"
                      class="w-8 h-8 mr-2"
                    />
                    {{ selo.nome }}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
            <button
              type="button"
              onclick="toggleEditForm()"
              class="mt-4 text-white bg-red-600 hover:bg-red-500 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2"
            >
              Editar Perfil
            </button>
          </div>

          <form
            id="editForm"
            class="edit-form hidden bg-white p-6 rounded-lg shadow-md mt-6"
            action="{{ url_for('editar_perfil') }}"
            method="POST"
          >
            <h2 class="text-xl font-semibold mb-4">Editar Perfil</h2>
            <input type="hidden" name="id" value="{{ usuario.id }}" />
            <div class="form-group mb-4">
              <label for="nome" class="form-label">Nome Completo:</label>
              <input
                type="text"
                id="nome"
                name="nome"
                class="form-input w-full p-2 border rounded"
                value="{{ usuario.nome }}"
                required
              />
            </div>
            <div class="form-group mb-4">
              <label for="email" class="form-label">Email:</label>
              <input
                type="email"
                id="email"
                name="email"
                class="form-input w-full p-2 border rounded"
                value="{{ usuario.email }}"
                required
              />
            </div>
            <div class="form-group mb-4">
              <label for="telefone" class="form-label">Telefone:</label>
              <input
                type="text"
                id="telefone"
                name="telefone"
                class="form-input w-full p-2 border rounded"
                value="{{ usuario.telefone }}"
                required
              />
            </div>
            <div class="form-group mb-4">
              <label for="data_nascimento" class="form-label">Data de Nascimento:</label>
              <input
                type="text"
                id="data_nascimento"
                name="data_nascimento"
                class="form-input w-full p-2 border rounded"
                value="{{ usuario.data_nascimento }}"
                placeholder="DD/MM/AAAA"
                required
              />
            </div>
            <div class="form-group mb-4">
              <label for="genero" class="form-label">Gênero:</label>
              <select
                id="genero"
                name="genero"
                class="form-input w-full p-2 border rounded"
                required
              >
                <option value="Masculino" {% if usuario.genero == 'Masculino' %}selected{% endif %}>Masculino</option>
                <option value="Feminino" {% if usuario.genero == 'Feminino' %}selected{% endif %}>Feminino</option>
                <option value="Outro" {% if usuario.genero == 'Outro' %}selected{% endif %}>Outro</option>
              </select>
            </div>
            <div class="form-group mb-4">
              <label for="cep" class="form-label">CEP:</label>
              <input
                type="text"
                id="cep"
                name="cep"
                class="form-input w-full p-2 border rounded"
                value="{{ usuario.cep }}"
                required
              />
            </div>
            <div class="form-group mb-4">
              <label for="endereco" class="form-label">Endereço:</label>
              <input
                type="text"
                id="endereco"
                name="endereco"
                class="form-input w-full p-2 border rounded"
                value="{{ usuario.endereco }}"
                required
              />
            </div>
            <div class="form-group mb-4">
              <label for="tipo_sanguineo" class="form-label">Tipo Sanguíneo:</label>
              <select
                id="tipo_sanguineo"
                name="tipo_sanguineo"
                class="form-input w-full p-2 border rounded"
                required
              >
                <option value="A+" {% if usuario.tipo_sanguineo == 'A+' %}selected{% endif %}>A+</option>
                <option value="A-" {% if usuario.tipo_sanguineo == 'A-' %}selected{% endif %}>A-</option>
                <option value="B+" {% if usuario.tipo_sanguineo == 'B+' %}selected{% endif %}>B+</option>
                <option value="B-" {% if usuario.tipo_sanguineo == 'B-' %}selected{% endif %}>B-</option>
                <option value="AB+" {% if usuario.tipo_sanguineo == 'AB+' %}selected{% endif %}>AB+</option>
                <option value="AB-" {% if usuario.tipo_sanguineo == 'AB-' %}selected{% endif %}>AB-</option>
                <option value="O+" {% if usuario.tipo_sanguineo == 'O+' %}selected{% endif %}>O+</option>
                <option value="O-" {% if usuario.tipo_sanguineo == 'O-' %}selected{% endif %}>O-</option>
              </select>
            </div>
            <div class="form-group mb-4">
              <label for="ja_doou" class="form-label">Já doou sangue?:</label>
              <select
                id="ja_doou"
                name="ja_doou"
                class="form-input w-full p-2 border rounded"
                required
              >
                <option value="sim" {% if usuario.ja_doou == 'sim' %}selected{% endif %}>Sim</option>
                <option value="não" {% if usuario.ja_doou == 'não' %}selected{% endif %}>Não</option>
              </select>
            </div>
            <div class="form-group mb-4">
              <label for="primeira_vez" class="form-label">Primeira vez (data):</label>
              <input
                type="text"
                id="primeira_vez"
                name="primeira_vez"
                class="form-input w-full p-2 border rounded"
                value="{{ usuario.primeira_vez or '' }}"
                placeholder="DD/MM/AAAA"
              />
            </div>
            <div class="form-group mb-4">
              <label for="interesse" class="form-label">Interesse em doar:</label>
              <select
                id="interesse"
                name="interesse"
                class="form-input w-full p-2 border rounded"
                required
              >
                <option value="sim" {% if usuario.interesse == 'sim' %}selected{% endif %}>Sim</option>
                <option value="não" {% if usuario.interesse == 'não' %}selected{% endif %}>Não</option>
              </select>
            </div>
            <div class="form-group mb-4">
              <label for="autoriza_msg" class="form-label">Autoriza mensagens?:</label>
              <input
                type="checkbox"
                id="autoriza_msg"
                name="autoriza_msg"
                value="sim"
                {% if usuario.autoriza_msg %}checked{% endif %}
                class="form-input"
              />
            </div>
            <div class="form-group mb-4">
              <label for="autoriza_dados" class="form-label">Autoriza uso de dados?:</label>
              <input
                type="checkbox"
                id="autoriza_dados"
                name="autoriza_dados"
                value="sim"
                {% if usuario.autoriza_dados %}checked{% endif %}
                class="form-input"
              />
            </div>
            <div class="form-group mb-4">
              <label for="senha" class="form-label">Nova Senha (opcional):</label>
              <input
                type="password"
                id="senha"
                name="senha"
                class="form-input w-full p-2 border rounded"
                placeholder="Deixe em branco para manter a senha atual"
              />
            </div>
            <div class="flex space-x-4">
              <button
                type="submit"
                class="text-white bg-red-600 hover:bg-red-500 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2"
              >
                Salvar Alterações
              </button>
              <button
                type="button"
                onclick="toggleEditForm()"
                class="text-white bg-gray-600 hover:bg-gray-500 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg text-sm px-4 py-2"
              >
                Cancelar
              </button>
            </div>
          </form>
        {% endif %}
      </section>
    </main>


    <script src="https://cdn.jsdelivr.net/npm/flowbite@2.4.1/dist/flowbite.min.js"></script>
    <script>
      function toggleEditForm() {
        const form = document.getElementById('editForm');
        form.classList.toggle('hidden');
      }
    </script>
  </body>
</html>